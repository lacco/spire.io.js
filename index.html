<!DOCTYPE html>  <html> <head>   <title>spire.io.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               spire.io.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <p>spire.io.js is a library designed to help you get your client-side web
applications up and running with the high level services provided by the
spire.io API. This plugin also exposes a methodology for directly interfacing
with the spire.io REST interface.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>You can learn more about spire.io and it's services at http://spire.io, or
find help with the following things:
<a href="http://github.com/spire-io/spire.io.js">source code</a>
<a href="http://github.com/spire-io/spire.io.js/issues">issues</a>
<a href="http://spire.io/contact.html">contact spire.io</a></p>

<p>These are the docs for the main file, spire.io.js.  Here are links to the
other files:
<a href="account.html">account</a>
<a href="api.html">api</a>
<a href="billing.html">billing</a>
<a href="channel.html">channel</a>
<a href="resource.html">resource</a>
<a href="response_error.html">response_error</a>
<a href="session.html">session</a>
<a href="subscription.html">subscription</a></p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">var</span> <span class="nx">async</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;async&#39;</span><span class="p">)</span>
  <span class="p">,</span> <span class="nx">API</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./spire/api&#39;</span><span class="p">)</span>
  <span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <h1>Spire</h1>

<p>Creates a new instance of Spire client.</p>

<p>Usage:</p>

<pre><code>var spire = new Spire();
</code></pre>

<p><b>constructor</b></p>

<p><b>param</b> {object} opts Options for Spire</p>

<p><b>param</b> {string} opts.url Spire url do use (defaults to 'https://api.spire.io')</p>

<p><b>param</b> {string} opts.version Version of Spire api to use (defaults to '1.0')</p>

<p><b>param</b> {number} opts.timeout Timeout for requests (defaults to 30 seconds)</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">var</span> <span class="nx">Spire</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">opts</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">api</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">API</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">opts</span><span class="p">);</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">session</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
<span class="p">};</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">Spire</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <h2>Public Interface</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <h3>Spire.prototype.key</h3>

<p>Returns the account key.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Spire</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">key</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">session</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">session</span><span class="p">.</span><span class="nx">resources</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">session</span><span class="p">.</span><span class="nx">resources</span><span class="p">.</span><span class="nx">account</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">session</span><span class="p">.</span><span class="nx">resources</span><span class="p">.</span><span class="nx">account</span><span class="p">.</span><span class="nx">key</span><span class="p">();</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <h3>Spire.prototype.discover</h3>

<p>Discovers urls from Spire API.</p>

<p><b>param</b> {function(err, discovered)} cb Callback</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Spire</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">discover</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">api</span><span class="p">.</span><span class="nx">discover</span><span class="p">(</span><span class="nx">cb</span><span class="p">);</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <h3>Spire.prototype.start</h3>

<p>Starts the Spire session with the given account key.</p>

<p>Usage:</p>

<pre><code>var spire = new Spire();
spire.stark(your_api_key, function (err, session) {
  if (!err) {
    // You now have a spire session.
    // Start creating channels and subscripions.
  }
});
</code></pre>

<p><b>param</b> {string} key The acccount key</p>

<p><b>param</b> {function(err)} cb Callback</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Spire</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">start</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">spire</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">discover</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">spire</span><span class="p">.</span><span class="nx">api</span><span class="p">.</span><span class="nx">createSession</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">session</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="k">return</span> <span class="nx">cb</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
      <span class="nx">spire</span><span class="p">.</span><span class="nx">session</span> <span class="o">=</span> <span class="nx">session</span><span class="p">;</span>
      <span class="nx">cb</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
    <span class="p">});</span>
  <span class="p">});</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <h3>Spire.prototype.login</h3>

<p>Starts the Spire session with the given username and password.</p>

<p>Usage:</p>

<pre><code>var spire = new Spire();
spire.login({
  email: your_email,
  password: your_password
}, function (err, session) {
  if (!err) {
    // You now have a spire session.
    // Start creating channels and subscripions.
  }
});
</code></pre>

<p><b>param</b> {string} email Email</p>

<p><b>param</b> {string} password Password</p>

<p><b>param</b> {function(err)} cb Callback</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Spire</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">login</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">email</span><span class="p">,</span> <span class="nx">password</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">spire</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">discover</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">spire</span><span class="p">.</span><span class="nx">api</span><span class="p">.</span><span class="nx">login</span><span class="p">(</span><span class="nx">email</span><span class="p">,</span> <span class="nx">password</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">session</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="k">return</span> <span class="nx">cb</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
      <span class="nx">spire</span><span class="p">.</span><span class="nx">session</span> <span class="o">=</span> <span class="nx">session</span><span class="p">;</span>
      <span class="nx">cb</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
    <span class="p">});</span>
  <span class="p">});</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <h3>Spire.prototype.register</h3>

<p>Register for a new spire account, and authenticates as the newly created account</p>

<p>Usage:</p>

<pre><code>var spire = new Spire();
spire.register({
  email: your_email,
  password: your_password,
  password_confirmation: your_password_confirmation
}, function (err, session) {
  if (!err) {
    // Your account has been registered,
    // and you now have a spire session.
    // Start creating channels and subscripions.
  }
});
</code></pre>

<p><b>param</b> {object} user User info</p>

<p><b>param</b> {string} user.email Email</p>

<p><b>param</b> {string} user.password Password</p>

<p><b>param</b> {string} [user.password_confirmation] Optional password confirmation</p>

<p><b>param</b> {function (err)} cb Callback</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Spire</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">register</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">user</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">spire</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">discover</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">spire</span><span class="p">.</span><span class="nx">api</span><span class="p">.</span><span class="nx">createAccount</span><span class="p">(</span><span class="nx">user</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">session</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="k">return</span> <span class="nx">cb</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
      <span class="nx">spire</span><span class="p">.</span><span class="nx">session</span> <span class="o">=</span> <span class="nx">session</span><span class="p">;</span>
      <span class="nx">cb</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
    <span class="p">});</span>
  <span class="p">});</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <h3>Spire.prototype.update</h3>

<p>Update your account info.</p>

<p>Usage:</p>

<pre><code>var spire = new Spire();
spire.update({
  email: 'new_you
</code></pre>

<p><b>new</b>_email.com',
    }, function (err, session) {
      if (!err) {
        // Your account has been updated.
      }
    });</p>

<p><b>param</b> {object} user User info</p>

<p><b>param</b> {string} user.email Email</p>

<p><b>param</b> {string} user.password Password</p>

<p><b>param</b> {string} [user.password_confirmation] Optional password confirmation</p>

<p><b>param</b> {function (err)} cb Callback</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Spire</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">update</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">user</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">session</span><span class="p">.</span><span class="nx">resources</span><span class="p">.</span><span class="nx">account</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">user</span><span class="p">,</span> <span class="nx">cb</span><span class="p">);</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <h3>Spire.prototype.passwordResetRequest</h3>

<p>Request a password reset for email.</p>

<p>Usage:</p>

<pre><code>var spire = new Spire();
spire.passwordResetRequest({
  email: 'you
</code></pre>

<p><b>email</b>.com',
    }, function (err, session) {
      if (!err) {
        // A password reset email has been sent.
      }
    });</p>

<p><b>param</b> {string} email Email</p>

<p><b>param</b> {function (err)} cb Callback</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Spire</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">passwordResetRequest</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">email</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">spire</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">discover</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">spire</span><span class="p">.</span><span class="nx">api</span><span class="p">.</span><span class="nx">passwordResetRequest</span><span class="p">(</span><span class="nx">email</span><span class="p">,</span> <span class="nx">cb</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <h3>Spire.prototype.channel</h3>

<p>Gets a channel (creates if necessary).</p>

<p>Usage:</p>

<pre><code>var spire = new Spire();
spire.start(your_api_key, function (err, session) {
  spire.channel('foo', function (err, channel) {
    if (!err) {
      // `channel` is the channel named "foo".
    }
  });
});
</code></pre>

<p><b>param</b> {string} name Channel name to get or create</p>

<p><b>param</b> {function(err, channel)} cb Callback</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Spire</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">channel</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">session</span><span class="p">.</span><span class="nx">_channels</span><span class="p">[</span><span class="nx">name</span><span class="p">])</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">cb</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">session</span><span class="p">.</span><span class="nx">_channels</span><span class="p">[</span><span class="nx">name</span><span class="p">]);</span>
  <span class="p">}</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">_findOrCreateChannel</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">cb</span><span class="p">);</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <h3>Spire.prototype.channels</h3>

<p>Gets a list of all channels.  Will return cached data if it is available,
otherwise will make a request.</p>

<p>Usage:</p>

<pre><code>var spire = new Spire();
spire.start(your_api_key, function (err, session) {
  spire.channels(function (err, channels) {
    if (!err) {
      // `channels` is a hash of all the account's channels
    }
  });
});
</code></pre>

<p><b>param</b> {function (err, channels)} cb Callback</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Spire</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">channels</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">spire</span><span class="p">.</span><span class="nx">session</span><span class="p">.</span><span class="nx">channels</span><span class="p">(</span><span class="nx">cb</span><span class="p">);</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <h3>Spire.prototype.channels$</h3>

<p>Gets a list of all channels.  Ignores any cached data, and forces the
request.</p>

<p>Usage is same as Spire.prototype.channels</p>

<p><b>param</b> {function (err, channels)} cb Callback</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Spire</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">channels$</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">spire</span><span class="p">.</span><span class="nx">session</span><span class="p">.</span><span class="nx">channels$</span><span class="p">(</span><span class="nx">cb</span><span class="p">);</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <h3>Spire.prototype.subscribe</h3>

<p>Gets a subscription to the given channels.  Creates the channels and the
subscription if necessary.</p>

<p>Usage:</p>

<pre><code>var spire = new Spire();
spire.start(your_api_key, function (err, session) {
  spire.subscribe('mySubscription', ['foo', 'bar'], function (err, subscription) {
    if (!err) {
      // `subscription` is a subscription named 'mySubscription', listening on channels named 'foo' and 'bar'.
    }
  });
});
</code></pre>

<p><b>param</b> {string} Subscription name</p>

<p><b>param</b> {array or string} channelOrChannels Either a single channel name, or an array of
  channel names to subscribe to</p>

<p><b>param</b> {function (err, subscription)} cb Callback</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Spire</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">subscribe</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">channelOrChannels</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">channelNames</span> <span class="o">=</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">channelOrChannels</span> <span class="o">===</span> <span class="s1">&#39;string&#39;</span><span class="p">)</span>
    <span class="o">?</span> <span class="p">[</span><span class="nx">channelOrChannels</span><span class="p">]</span>
    <span class="o">:</span> <span class="nx">channelOrChannels</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">spire</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
  <span class="nx">async</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span>
    <span class="nx">channelNames</span><span class="p">,</span>
    <span class="kd">function</span> <span class="p">(</span><span class="nx">channelName</span><span class="p">,</span> <span class="nx">innerCB</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">spire</span><span class="p">.</span><span class="nx">_findOrCreateChannel</span><span class="p">(</span><span class="nx">channelName</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">channel</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">innerCB</span><span class="p">();</span>
      <span class="p">});</span>
    <span class="p">},</span>
    <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="k">return</span> <span class="nx">cb</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
      <span class="nx">spire</span><span class="p">.</span><span class="nx">_findOrCreateSubscription</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">channelNames</span><span class="p">,</span> <span class="nx">cb</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">);</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <h3>Spire.prototype.subscriptions</h3>

<p>Get the subscriptions for an account.  Will return cached data if it is
available, otherwise makes a request.</p>

<p>Usage:</p>

<pre><code>var spire = new Spire();
spire.start(your_api_key, function (err, session) {
  spire.subscriptions(function (err, subscriptions) {
    if (!err) {
      // `subscriptions` is a hash of all the account's subscriptions
    }
  });
});
</code></pre>

<p><b>param</b> {function (err, subscriptions)} cb Callback</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Spire</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">subscriptions</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">session</span><span class="p">.</span><span class="nx">subscriptions</span><span class="p">(</span><span class="nx">cb</span><span class="p">);</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <h3>Spire.prototype.subscriptions$</h3>

<p>Get the subscriptions for an account.  Ignores any cached data and always
makes a request.</p>

<p>Usage is the same as Spire.prototype.subscriptions.</p>

<p><b>param</b> {function (err, subscriptions)} cb Callback</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Spire</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">subscriptions$</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">session</span><span class="p">.</span><span class="nx">subscriptions$</span><span class="p">(</span><span class="nx">cb</span><span class="p">);</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <h2>Private Interface</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <h3>Spire.prototype.CREATION<em>RETRY</em>LIMIT</h3>

<p>Number of times to retry creating a channel or subscription before giving up.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Spire</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">CREATION_RETRY_LIMIT</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <h3>Spire.prototype._findOrCreateChannel</h3>

<p>Returns the channel with name 'name', creating it if necessary.</p>

<p>You should use <code>Spire.prototype.channel</code> method instead of this one.  This
method ignores cached channels.</p>

<p><b>param</b> {string} name Channel name</p>

<p><b>param</b> {function (err, channel)} cb Callback</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Spire</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_findOrCreateChannel</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">spire</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">creationCount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">createChannel</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">creationCount</span><span class="o">++</span><span class="p">;</span>
    <span class="nx">spire</span><span class="p">.</span><span class="nx">session</span><span class="p">.</span><span class="nx">createChannel</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">channel</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">err</span><span class="p">)</span> <span class="k">return</span> <span class="nx">cb</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">channel</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nx">status</span> <span class="o">!==</span> <span class="mi">409</span><span class="p">)</span> <span class="k">return</span> <span class="nx">cb</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">creationCount</span> <span class="o">&gt;=</span> <span class="nx">spire</span><span class="p">.</span><span class="nx">CREATION_RETRY_LIMIT</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">cb</span><span class="p">(</span><span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;Could not create channel: &quot;</span> <span class="o">+</span> <span class="nx">name</span><span class="p">));</span>
      <span class="p">}</span>
      <span class="nx">getChannel</span><span class="p">();</span>
    <span class="p">});</span>
  <span class="p">};</span>

  <span class="kd">var</span> <span class="nx">getChannel</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">spire</span><span class="p">.</span><span class="nx">session</span><span class="p">.</span><span class="nx">channels$</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">channels</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">err</span> <span class="o">&amp;&amp;</span> <span class="nx">channels</span><span class="p">[</span><span class="nx">name</span><span class="p">])</span> <span class="k">return</span> <span class="nx">cb</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">channels</span><span class="p">[</span><span class="nx">name</span><span class="p">]);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="o">&amp;&amp;</span> <span class="nx">err</span><span class="p">.</span><span class="nx">status</span> <span class="o">!==</span> <span class="mi">409</span><span class="p">)</span> <span class="k">return</span> <span class="nx">cb</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
      <span class="nx">createChannel</span><span class="p">();</span>
    <span class="p">});</span>
  <span class="p">};</span>

  <span class="nx">createChannel</span><span class="p">();</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <h3>Spire.prototype.findOrCreateSubscription</h3>

<p>Returns the subvscription with name 'name', creating it if necessary.</p>

<p>You should use <code>Spire.prototype.subscribe</code> method instead of this one.  This
method ignores cached subscriptions, and does not create the channels.</p>

<p><b>param</b> {string} name Subscription name</p>

<p><b>param</b> {string} channelNames Channel names</p>

<p><b>param</b> {function (err, subscription)} cb Callback</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">Spire</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_findOrCreateSubscription</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">channelNames</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">spire</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">creationCount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">createSubscription</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">creationCount</span><span class="o">++</span><span class="p">;</span>
    <span class="nx">spire</span><span class="p">.</span><span class="nx">session</span><span class="p">.</span><span class="nx">createSubscription</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">channelNames</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">sub</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">err</span><span class="p">)</span> <span class="k">return</span> <span class="nx">cb</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">sub</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nx">status</span> <span class="o">!==</span> <span class="mi">409</span><span class="p">)</span> <span class="k">return</span> <span class="nx">cb</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">creationCount</span> <span class="o">&gt;=</span> <span class="nx">spire</span><span class="p">.</span><span class="nx">CREATION_RETRY_LIMIT</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">cb</span><span class="p">(</span><span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;Could not create subscription: &quot;</span> <span class="o">+</span> <span class="nx">name</span><span class="p">));</span>
      <span class="p">}</span>
      <span class="nx">getSubscription</span><span class="p">();</span>
    <span class="p">});</span>
  <span class="p">};</span>

  <span class="kd">var</span> <span class="nx">getSubscription</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">spire</span><span class="p">.</span><span class="nx">session</span><span class="p">.</span><span class="nx">subscriptions$</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">subscriptions</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">err</span> <span class="o">&amp;&amp;</span> <span class="nx">subscriptions</span><span class="p">[</span><span class="nx">name</span><span class="p">])</span> <span class="k">return</span> <span class="nx">cb</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">subscriptions</span><span class="p">[</span><span class="nx">name</span><span class="p">]);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="o">&amp;&amp;</span> <span class="nx">err</span><span class="p">.</span><span class="nx">status</span> <span class="o">!==</span> <span class="mi">409</span><span class="p">)</span> <span class="k">return</span> <span class="nx">cb</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
      <span class="nx">createSubscription</span><span class="p">();</span>
    <span class="p">});</span>
  <span class="p">};</span>

  <span class="nx">createSubscription</span><span class="p">();</span>
<span class="p">};</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 